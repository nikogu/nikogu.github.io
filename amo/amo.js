/**
 * amo.js
 * easy to use css animation
 * http://nikogu.github.com/amo
 *
 * @author niko
 * @date 2014-12-31
 */
;(function(exports){var Animations={},prefix=["","-webkit-"];function inArray(arr,item){return arr.indexOf(item)}function isArray(arr){return Object.prototype.toString.call(arr)==="[object Array]"||arr.length!==undefined}function isNumber(num){return Object.prototype.toString.call(num)==="[object Number]"}function all(items,callback){if(isArray(items)){Array.prototype.forEach.call(items,function(item){callback(item)})}else{callback(items)}}function addClass(node,clazz){var classArr=node.className.split(" ");if(inArray(classArr,clazz)==-1){classArr.push(clazz);node.className=classArr.join(" ")}}function hasClass(node,clazz){var classArr=node.className.split(" ");return inArray(classArr,clazz)!=-1}function removeClass(node,clazz){var classArr=node.className.split(" ");var index=inArray(classArr,clazz);if(index>=0){classArr.splice(index,1);node.className=classArr.join(" ")}}(function(){if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(" this is null or not defined")}var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!="[object Function]"){throw new TypeError(callback+" is not a function")}if(thisArg){T=thisArg}A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue}k++}return A}}})();var importStyle=(function importStyle(){var RE_NON_WORD=/\W/g;var doc=document;var head=document.getElementsByTagName("head")[0]||document.documentElement;var styleNode;var handle=function(cssText,id){if(id){id=id.replace(RE_NON_WORD,"-");if(doc.getElementById(id)){return}}var element;if(!styleNode||id){element=doc.createElement("style");id&&(element.id=id);head.appendChild(element)}else{element=styleNode}if(element.styleSheet!==undefined){if(doc.getElementsByTagName("style").length>31){throw new Error("Exceed the maximal count of style tags in IE")}element.styleSheet.cssText+=cssText}else{element.appendChild(doc.createTextNode(cssText))}if(!id){styleNode=element}};return handle})();function getRandomFrameName(){return"Amo-frame-"+Math.floor(Math.random()*10000000)}function getRandomTName(){return"Amo-transition-"+Math.floor(Math.random()*10000000)}function createAnimStyle(name,from,to){var keyframes=prefix.map(function(val){return val+"keyframes"});var fullStyle="";var style="{";if(to){style+="0% {";for(var prop in from){style+=prop+":";style+=from[prop]+";"}style+="}";style+="100% {";for(var prop in to){style+=prop+":";style+=to[prop]+";"}style+="}"}else{for(var prop in from){if(isNumber(prop*1)&&from.hasOwnProperty(prop)){style+=prop+"% {";for(var p in from[prop]){style+=p+":";style+=from[prop][p]+";"}style+="}"}}}style+="}";for(var i=0;i<keyframes.length;i++){fullStyle+="@"+keyframes[i]+" "+name;fullStyle+=style}return fullStyle}function createCssAnimation(animName,duration,easing,time,delay,direction,mode){var animations=prefix.map(function(val){return val+"animation"}),style="";var className=getRandomTName();style+="."+className+"{";for(var i=animations.length;i--;){style+=animations[i]+"-name:"+animName+";";style+=animations[i]+"-duration:"+(duration/1000)+"s;";style+=animations[i]+"-timing-function:"+easing+";";style+=animations[i]+"-iteration-count:"+time+";";style+=animations[i]+"-fill-mode:"+mode+";";style+=animations[i]+"-delay:"+delay+";";style+=animations[i]+"-direction:"+direction+";"}style+="}";importStyle(style);return className}function keyframes(from,to){var frameName=getRandomFrameName();Animations[frameName]={frameName:frameName,style:createAnimStyle(frameName,from,to),animate:animate};importStyle(Animations[frameName].style);return Animations[frameName]}function animate(conf){var conf=conf||{};var time=conf.time||1;if(time<0){time="infinite"}var duration=conf.duration||1000,easing=conf.easing||"ease",delay=conf.delay||0,direction=conf.direction||"normal",mode=conf.mode||"forwards";var className=createCssAnimation(this.frameName,duration,easing,time,delay,direction,mode);return{className:className,time:time,duration:duration,run:run}}function run(node,callback){var className=this.className,duration=this.duration,time=this.time;var timer;all(node,function(item){removeClass(item,className)});setTimeout(function(){all(node,function(item){addClass(item,className)})},0);var ins={className:className,timer:timer,node:node,time:time,duration:duration,totalTime:duration*time,callback:callback,stop:stop,start:start,reset:reset};ins.start();return ins}function stop(){var that=this;if(isNumber(that.time)&&that.callback){that.state="stop";that.stopTime=new Date().getTime();clearTimeout(that.timer)}all(that.node,function(item){addClass(item,"amo-animation-pause")})}function start(){var that=this;if(isNumber(that.time)&&that.callback){if(that.state=="stop"){that.totalTime-=(that.stopTime-that.startTime);all(that.node,function(item){removeClass(item,"amo-animation-pause")})}if(that.state!="running"&&!that.isOver){that.state="running";that.startTime=new Date().getTime();
    that.timer=setTimeout(function(){that.isOver=true;that.callback()},that.totalTime)}}else{all(that.node,function(item){removeClass(item,"amo-animation-pause")})}}function reset(){var that=this;that.isOver=false;that.state="";that.totalTime=that.duration*that.time;all(that.node,function(item){removeClass(item,that.className)});setTimeout(function(){all(that.node,function(item){addClass(item,that.className)})},0);that.start()}(function(){var style=".amo-animation-pause { ";for(var i=prefix.length;i--;){style+=prefix[i]+"animation-play-state: paused !important;"}style+="}";importStyle(style)})();var Amo={keyframes:keyframes};exports.Amo=Amo})(window);