KISSY.add(function(){var a=function(){var a=1,b=new Function,c=new Function;c.prototype.startAt=0,c.prototype.duration=0,c.prototype.object=null,c.prototype.startHandle=b,c.prototype.updateHandle=b,c.prototype.endHandle=b,c.prototype.stopHandle=b,c.prototype.started=!1,c.prototype.stopped=!1,c.prototype.handleStart=function(a){return this.startHandle=a.bind(this.object),this},c.prototype.handleUpdate=function(a){return this.updateHandle=a.bind(this.object),this},c.prototype.handleEnd=function(a){return this.endHandle=a.bind(this.object),this},c.prototype.handleStop=function(a){return this.stopHandle=a.bind(this.object),this},c.prototype.handleEndStop=function(a){return this.endHandle=this.stopHandle=a.bind(this.object),this},c.prototype.start=function(){this.startHandle(),this.updateHandle(0),this.started=!0},c.prototype.update=function(a){this.updateHandle(a)},c.prototype.stop=function(){this.stopHandle(),this.stopped=!0},c.prototype.end=function(){this.updateHandle(this.duration),this.endHandle(),this.stopped=!0},c.create=function(){return new this};var d=new Function;d.prototype.running=!1,d.prototype.initTime=-1,d.prototype.intervalTime=1e3/60,d.prototype.interval=-1,d.prototype.deductionTime=0,d.prototype.tasks=null,d.prototype.addingTasks=null,d.prototype.adding=!1,d.prototype.intervalFn=null,d.prototype.lastStopTime=-1,d.prototype.init=function(a){return this.initTime<0&&(this.initTime=g(),a&&(this.intervalTime=a),this.start()),this},d.prototype.createTask=function(a){var b,d=c.create();return d.startAt=a.start?a.start+g()-this.deductionTime:g()-this.deductionTime,-1==a.duration?d.duration=1/0:a.duration&&(d.duration=a.duration),a.object&&(d.object=a.object),(b=a.onStart||a.onTimeStart)&&d.handleStart(b),(b=a.onUpdate||a.onTimeUpdate)&&d.handleUpdate(b),(b=a.onEnd||a.onTimeEnd)&&d.handleEnd(b),(b=a.onStop||a.onTimeStop)&&d.handleStop(b),this.addingTasks.unshift(d),this.adding=!0,d},d.prototype.setTimeout=function(a,b){return this.createTask({start:b}).handleStart(a)},d.prototype.clearTimeout=function(a){a.stop()},d.prototype.setInterval=function(a,b){var c=setInterval(a,b);return{stop:function(){clearInterval(c)}}},d.create=function(){var a=new this;return a.tasks=[],a.addingTasks=[],a.intervalFn=function(){a.update(g())},a},d.prototype.start=function(){this.running||(this.lastStopTime>0&&(this.deductionTime+=g()-this.lastStopTime,this.lastStopTime=-1),this.interval=setInterval(this.intervalFn,this.intervalTime),this.running=!0)},d.prototype.stop=function(){this.running&&(clearInterval(this.interval),this.lastStopTime=g(),this.running=!1)},d.prototype.clearTasks=function(){for(var a=this.tasks,b=this.addingTasks,c=a.length-1;c>=0;c--)a[c].stop();if(a.length=0,this.adding){for(var c=b.length-1;c>=0;c--)b[c].stop();b.length=0,this.adding=!1}},d.prototype.update=function(a){var b,c,d=this.tasks,e=this.addingTasks,g=d.length;for(a-=this.deductionTime;g--;)c=d[g],b=a-c.startAt,c.stopped?d.splice(g,1):b>=0&&(c.started||c.start(),b<c.duration?c.update(b):(c.end(),d.splice(g,1)));e.length&&(f.apply(d,e),e.length=0)};var e={};e.caches={},e.use=function(a){var b;return(b=e.caches[a])?b:e.caches[a]=d.create()},e.stopAllTimer=function(){var a=e.caches;for(var b in a)a[b].stop()},e.startAllTimer=function(){var a=e.caches;for(var b in a)a[b].start()},e.clearAllTasks=function(){var a=e.caches;for(var b in a)a[b].clearTasks()},e.registry=function(a){a.Timeline=e};var f=[].unshift,g=function(){return(new Date).getTime()*a};return e}();return a});