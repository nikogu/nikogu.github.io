{"version":3,"sources":["assets/img/p1.png","serviceWorker.ts","tools/calculate.tsx","tools/circle.tsx","tools/quad.tsx","tools/common.tsx","component/Error.tsx","tools/hooks.tsx","App.tsx","index.tsx"],"names":["module","exports","Boolean","window","location","hostname","match","weightedAverage","histogram","total","value","i","error","Math","sqrt","reverseSquareArrayByStep","array","step","b","j","length","concat","slice","reverse","computeSplitQuad","quad","array2d","log2","quads","split","children","SplitQuad","forEach","item","childrenLeaf","w","push","a","sort","y","flat","sortQuadArray","Circle","svg","init","circle","selectAll","data","enter","append","attr","d","x","h","transition","duration","parent","color","each","node","this","sum","items","prop","reduce","Quad","p","imageContext","e","point","ctx","score","subarray","r","re","g","ge","be","round","colorFromHistogram","getImageData","Uint32Array","n","computeHistogram","toString","substring","pow","args","dx","x1","x2","dy","y1","y2","filter","svgNode","d3","remove","getRandom","floor","random","Error","title","detail","onClose","className","onClick","useInterval","useState","setSvg","leafs","setLeafs","delay","setDelay","useEffect","id","setInterval","q","shift","undefined","splitToCircle","clearInterval","App","errorVisible","setError","images","p1","dotRef","useRef","canvasRef","startInterval","quadImage","setQuadImage","context","current","getContext","img","Image","onload","drawImage","style","src","height","width","ref","display","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","console","message"],"mappings":"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","file":"static/js/main.5cdffaaa.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/p1.9ca5ee3d.png\";","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import Quad from \"./quad\";\n\nfunction colorFromHistogram(histogram: Uint32Array) {\n    const [r, re] = weightedAverage(histogram.subarray(0, 256));\n    const [g, ge] = weightedAverage(histogram.subarray(256, 512));\n    const [b, be] = weightedAverage(histogram.subarray(512, 768));\n    return [\n        Math.round(r),\n        Math.round(g),\n        Math.round(b),\n        re * 0.2989 + ge * 0.5870 + be * 0.1140\n    ];\n}\n\nfunction weightedAverage(histogram: Uint32Array) {\n    // 加权平均值 weighted average value\n    let total = 0;\n    let value = 0;\n    for (let i = 0; i < 256; ++i) {\n        total += histogram[i];\n        value += histogram[i] * i;\n    }\n    value /= total;\n\n    // 加权标准差 WEIGHTED STANDARD DEVIATION\n    let error = 0;\n    for (let i = 0; i < 256; ++i) error += (value - i) ** 2 * histogram[i];\n    return [value, Math.sqrt(error / total)];\n}\n\nfunction computeHistogram(imageContext: CanvasRenderingContext2D, x: number, y: number, w: number, h: number) {\n    const {data} = imageContext.getImageData(x, y, w, h);\n    const histogram = new Uint32Array(1024);\n    // 将 RGBA 数组转化为直方图\n    // R: 0 - 256\n    // G: 256 - 512\n    // B: 512 - 768\n    // A: 768 - 1024\n    for (let i = 0, n = data.length; i < n; i += 4) {\n        ++histogram[0 * 256 + data[i + 0]];\n        ++histogram[1 * 256 + data[i + 1]];\n        ++histogram[2 * 256 + data[i + 2]];\n        ++histogram[3 * 256 + data[i + 3]];\n    }\n    return histogram;\n}\n\nfunction checkSplit(args: Array<number>): boolean {\n    return args.filter(x => x >= 4).length === args.length;\n}\n\nfunction reverseSquareArrayByStep(array: Array<Quad>, step: number){\n    let b : Quad[] = [];\n    for (let j = 0; j <= array.length; j += step * 2){\n        b = b.concat(array.slice(j, j + step), array.slice(j + step, j + step * 2).reverse())\n    }\n    return b;\n}\n\nfunction sortQuadArray(quads: Quad[][]){\n    for (let i = 0; i < quads.length; i++){\n        let a = quads[i];\n        a.sort((a, b) => a.y - b.y);\n        quads[i] = reverseSquareArrayByStep(a, Math.sqrt(a.length));\n    }\n    return quads.flat();\n}\n\nfunction computeSplitQuad (quad: Quad) {\n    let array2d: Quad[][] = [];\n    for (let i = 1; i < 128; i *= 2) {\n        array2d[Math.log2(i)] = [];\n    }\n    array2d[0] = [quad];\n    let quads = quad.split() as Array<Quad>;\n    quad.children = quads;\n    function SplitQuad (quads: Array<Quad>) {\n        quads.forEach((item: Quad) => {\n            let childrenLeaf = item.split();\n            // @ts-ignore\n            item.children = childrenLeaf;\n            if (childrenLeaf != null) {\n                array2d[Math.log2(128) - Math.log2(item.w / 4)].push(item)\n                SplitQuad(childrenLeaf)\n            } else {\n                return\n            }\n        })\n    }\n    SplitQuad(quads);\n    return sortQuadArray(array2d);\n}\n\nexport {\n    colorFromHistogram,\n    computeHistogram,\n    checkSplit,\n    computeSplitQuad\n}\n","import Quad from \"./quad\";\n\nexport default function Circle(svg: any, quads: null | Quad[], init: boolean) {\n    var circle = svg.selectAll('.a').data(quads)\n        .enter().append('circle');\n\n    if (init) {\n        // Setup the initial state of the initial circle\n        circle = circle\n            .attr('cx',   function(d: Quad) { return d.x + d.w / 2 ; })\n            .attr('cy',   function(d: Quad) { return d.y + d.h / 2; })\n            .attr('r', function(d: Quad) { return d.w / 1000; })\n            .attr('fill', '#fff')\n            .transition()\n            .duration(200);\n    } else {\n        // Setup the initial state of the opened circles\n        circle = circle\n            .attr('cx',   function(d: Quad) { return d.parent ? d.parent.x + d.parent.w / 2 : 0; })\n            .attr('cy',   function(d: Quad) { return d.parent ? d.parent.y + d.parent.h / 2 : 0; })\n            .attr('r',    function(d: Quad) { return d.parent ? d.parent.w / 2 : 0; })\n            .attr('fill', function(d: Quad) { return d.color ; })\n            .attr('fill-opacity', 0.18)\n            .transition()\n            .duration(50);\n    }\n\n    // Transition the to the respective final state\n    circle\n        .attr('cx',   function(d: Quad) { return d.x + d.w / 2; })\n        .attr('cy',   function(d: Quad) { return d.y + d.h / 2; })\n        .attr('r',    function(d: Quad) { return d.w / 2; })\n        .attr('fill', function(d: Quad) { return d.color; })\n        .attr('fill-opacity', 1)\n        .each(function(d: Quad) {\n            // @ts-ignore\n            d.node = this;\n        });\n}\n","import {checkSplit, colorFromHistogram, computeHistogram} from './calculate';\nimport * as d3 from \"d3\";\nimport Circle from \"./circle\";\n\nconst sum = function (items: Array<Quad | null>, prop: string){\n    return items.reduce( function(a, b){\n        // @ts-ignore\n        return prop === 'e' ?  a + b[prop] :  a + b[prop]()\n    }, 0);\n};\n\nclass Quad {\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    e: number;\n    color: string;\n    parent: null | Quad;\n    node: null | HTMLElement;\n    point: Array<number>;\n    children: Array<Quad>;\n    private ctx: CanvasRenderingContext2D;\n    private score: number;\n\n\n    //x: 将要被提取的图像数据矩形区域的左上角 x 坐标。\n    //y: 将要被提取的图像数据矩形区域的左上角 y 坐标。\n    //w: 将要被提取的图像数据矩形区域的宽度。\n    //h: 将要被提取的图像数据矩形区域的高度。\n\n    // error: rgb -> gray\n    constructor(x: number, y: number, w: number, h: number, p: null | Quad, imageContext: CanvasRenderingContext2D) {\n        const [r, g, b, error] = colorFromHistogram(computeHistogram(imageContext, x, y, w, h));\n        this.x = x;\n        this.y = y;\n        this.w = w;\n        this.h = h;\n        this.point = [x + h/2, y + w/2];\n        this.ctx = imageContext;\n        this.color = `#${(0x1000000 + (r << 16) + (g << 8) + b).toString(16).substring(1)}`;\n        this.score = error * Math.pow(w * h, 0.25);\n        this.e = error;\n        this.node = null;\n        this.parent = p;\n        this.children = [];\n    }\n\n    isSplitable(): boolean {\n        return this.node !== null && this.split() !== null\n    }\n\n    averageError(): number{\n        const quads = this.split();\n        if (quads == null) {\n            return 0;\n        } else {\n            return sum(quads, 'e') / 4;\n        }\n    }\n    averageChildError(): number{\n        const quads = this.split();\n        if (quads == null) {\n            return 0;\n        } else {\n            return sum(quads, 'averageError') / 4;\n        }\n    }\n    split(): Array<Quad> | null {\n        const dx = this.w / 2, x1 = this.x, x2 = this.x + dx;\n        const dy = this.h / 2, y1 = this.y, y2 = this.y + dy;\n\n        if (!checkSplit([dx, dy])) {\n            return null;\n        }\n\n        return [\n            new Quad(x1, y1, dx, dy, this, this.ctx),\n            new Quad(x2, y1, dx, dy, this, this.ctx),\n            new Quad(x1, y2, dx, dy, this, this.ctx),\n            new Quad(x2, y2, dx, dy, this, this.ctx)\n        ];\n    }\n    splitToCircle(svgNode: any){\n        if (!this.split()) return;\n        d3.select(this.node).remove();\n        delete this.node;\n        Circle(svgNode, this.children, false);\n    }\n}\n\n\nfunction getAllLeaf (quads: Array<Quad>) {\n    let result: Array<Quad> = [];\n    function getLeaf (quads: Array<Quad>) {\n        quads.forEach((item: Quad) => {\n            let childrenLeaf = item.split();\n            // @ts-ignore\n            item.children = childrenLeaf;\n            if (childrenLeaf != null) {\n                getLeaf(childrenLeaf)\n            } else {\n                result[item.x/4 * 128 + item.y/4] = item;\n            }\n        })\n    }\n    getLeaf(quads);\n    return result;\n}\n\nexport default Quad;\nexport {\n    getAllLeaf\n}\n","import p1 from '../assets/img/p1.png';\n\n\nconst findImage = (): Array<string> => {\n    return [p1]\n};\n\n\nconst getRandom = (data: Array<string>): string => {\n    return data[Math.floor(Math.random() * data.length)]\n};\n\nexport {\n    findImage,\n    getRandom\n}\n","import React from 'react';\nimport '../style/error.scss';\n\ninterface errorProps {\n    title: string;\n    detail: string;\n    onClose: () => void\n}\n\nexport default function Error({title, detail, onClose}: errorProps) {\n    return (\n        <div className=\"error-container\">\n            <div className=\"error-box\">\n                <div className=\"dot\" onClick={() => onClose()}/>\n                <div className=\"face\">\n                    <div className=\"eye\"/>\n                    <div className=\"eye right\"/>\n                    <div className=\"mouth sad\"/>\n                </div>\n                <div className=\"shadow move\"/>\n                <div className=\"message\">\n                    <h1 className=\"alert\">{title}</h1>\n                    <p>{detail}</p>\n                </div>\n            </div>\n        </div>\n    )\n}\n","import {useEffect, useState} from 'react';\nimport Quad from \"./quad\";\n\nfunction useInterval() {\n    const [svg, setSvg]  = useState<any>(null);\n    const [leafs, setLeafs]  = useState<any>(null);\n    const [delay, setDelay]  = useState<any>(1024);\n\n    // Set up the interval.\n    useEffect(() => {\n        if (leafs?.length === 0) return;\n        function tick() {\n            if (leafs?.length === 0) return;\n            if (leafs[0].w !== delay){\n                setDelay(leafs[0].w);\n            }\n            let q = leafs.shift();\n            if (q === undefined) {\n                return;\n            } else {\n                q.splitToCircle(svg);\n            }\n        }\n        if (delay !== null) {\n            let id = setInterval(tick, delay);\n            return () => clearInterval(id);\n        }\n    }, [delay, leafs, svg]);\n\n\n    function startInterval(svg: any, leafs: Quad[]){\n        setLeafs(leafs);\n        setSvg(svg);\n    }\n    return startInterval;\n}\n\nexport default useInterval;\n","import React, {useEffect, useRef, useState} from 'react';\nimport * as d3 from 'd3';\n\nimport Quad from './tools/quad';\nimport Circle from './tools/circle';\nimport {findImage, getRandom} from \"./tools/common\";\nimport Error from \"./component/Error\";\nimport {computeSplitQuad} from \"./tools/calculate\";\nimport useInterval from \"./tools/hooks\";\n\nfunction App() {\n  const [errorVisible, setError] = useState(false);\n  const images: Array<string> = findImage();\n\n  const dotRef = useRef(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const startInterval = useInterval();\n\n\n  const maxSize = 512;\n  const [quadImage, setQuadImage] = useState<string>(getRandom(images));\n\n  useEffect(() => {\n    let context = canvasRef.current?.getContext('2d') as CanvasRenderingContext2D;\n\n    let img = new Image();\n    img.onload = function(){\n      context.drawImage(img, 0, 0, maxSize, maxSize);\n      const svg = d3.select(dotRef.current)\n          .append(\"svg\")\n          .attr(\"viewBox\", `0 0 ${maxSize} ${maxSize}`)\n          .style(\"display\", \"block\");\n\n      const quad = new Quad(0, 0, maxSize, maxSize, null, context);\n      Circle(svg, [quad], true)\n      // todo : switch manual and auto mode\n      // canvas pause\n      // start listening event\n      // onEvent(quad, svg);\n      startInterval(svg, computeSplitQuad(quad));\n    };\n    img.src = quadImage;\n    // eslint-disable-next-line\n  }, [quadImage]);\n\n  return (\n      <>\n        {!errorVisible &&\n        <div className=\"center\">\n          <canvas height={maxSize} width={maxSize} ref={canvasRef} style={{display: \"none\"}}/>\n          {quadImage && <div className=\"dot\" ref={dotRef}>\n          </div>}\n        </div>}\n        {errorVisible && <Error title=\"Oops...\" detail=\"Seems image too large\"\n                                onClose={() => {\n                                  setQuadImage(getRandom(images));\n                                  setError(false);\n                                }}/>\n        }\n      </>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport * as serviceWorker from './serviceWorker';\n\nimport App from \"./App\";\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}